class zbCalendar extends HTMLElement{constructor(){super();const t=document.createElement("style");t.textContent="\n            :host {\n                display: inline-block;\n            }\n            .root {\n                min-width: 200px;\n                min-height: 200px;\n                height: 100%;\n                background-color: darkgray;\n                display: grid;\n                grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;\n                grid-template-rows: 1fr 2fr 2fr 2fr 2fr 2fr 2fr; \n                grid-column-gap: 1px;\n                grid-row-gap: 1px;\n            }\n\n            .parent-cell {\n                position: relative;\n                cursor: pointer;\n            }\n            .child-cell {\n                position: absolute;\n                color: rgb(248, 248, 248);\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                user-select: none;\n            }\n\n            .parent-dayOfWeek {\n                background-color: royalblue;\n                cursor: default;\n            }\n            .parent-normal-odd {\n                background-color: rgb(248, 248, 248);\n            }\n            .parent-normal-even {\n                background-color: rgb(230, 230, 230);\n            }\n            .parent-highlightColumn-odd {\n                background-color: lightgoldenrodyellow;\n            }\n            .parent-highlightColumn-even {\n                background-color: #dadab9;\n            }\n            .parent-selected {\n                background-color: #8dc8f7;\n                border: 2px solid #3f51b5;\n            }\n\n            .parent-normal-odd:hover {\n                background-color: lightsteelblue;\n            }\n            .parent-normal-even:hover {\n                background-color: lightsteelblue;\n            }\n            .parent-highlightColumn-odd:hover {\n                background-color: lightsteelblue;\n            }\n            .parent-highlightColumn-even:hover {\n                background-color: lightsteelblue;\n            }\n            .parent-selected:hover {\n                background-color: #6f9ec3;\n                border: 2px solid #3f51b5;\n            }\n\n            .child-dayOfWeek {\n                color: rgb(248, 248, 248);\n                font-size: 1em;\n            }\n            .child-normal {\n                color: rgb(48, 48, 48);\n                font-size: 2em;\n            }\n            .child-nonMonth {\n                color: #9e9e9e;\n                font-size: 2em;\n            }";const e=document.createElement("div");e.setAttribute("class","root"),this._dayOfWeekList=[],this._dayOfMonthList=[],this._createDaysOfWeek(e),this._createDaysOfMonth(e);const i=this.attachShadow({mode:"open"});i.appendChild(t),i.appendChild(e),this._clickEvent=this._clickEvent.bind(this),this.selectedEvent=new Event("selected")}get culture(){return this.getAttribute("culture")}set culture(t){zbValidate.isString(t),this.setAttribute("culture",t)}get value(){return this.getAttribute("value")}set value(t){zbValidate.isString(t),this.setAttribute("value",t)}get firstDay(){return this.getAttribute("first-day")}set firstDay(t){zbValidate.isString(t),this.setAttribute("first-day",t)}get highlightDays(){return this.getAttribute("highlight-days")}set highlightDays(t){zbValidate.isString(t),this.setAttribute("highlight-days",t)}get highlight(){return!0===this.hasAttribute("highlight")}set highlight(t){zbValidate.isBoolean(t),!0===t?this.setAttribute("highlight",t):this.removeAttribute("highlight")}_createDaysOfWeek(t){for(let e=1;e<=7;e++){const i={};i.parentCell=document.createElement("div"),i.parentCell.style.gridRow=1,i.parentCell.style.gridColumn=e,i.parentCell.className="parent-cell parent-dayOfWeek",i.childCell=document.createElement("div"),i.childCell.className="child-cell dayOfWeek-child",i.parentCell.appendChild(i.childCell),this._dayOfWeekList.push(i),t.appendChild(i.parentCell)}}_createDaysOfMonth(t){for(let e=2;e<=7;e++){const i={dayList:[]};for(let n=1;n<=7;n++){const r={day:0,month:0,highlighted:!1};r.parentCell=document.createElement("div"),r.parentCell.style.gridRow=e,r.parentCell.style.gridColumn=n,r.defaultClass="parent-cell",r.defaultClass+=n%2?" parent-normal-even":" parent-normal-odd",r.parentCell.className=r.defaultClass,r.childCell=document.createElement("div"),r.childCell.className="child-cell child-normal",r.parentCell.appendChild(r.childCell),i.dayList.push(r),t.appendChild(r.parentCell)}this._dayOfMonthList.push(i)}}connectedCallback(){this._updateGrid(),this._updateMonth(),this._addClickEventListener()}disconnectedCallback(){this._removeClickEventListener()}attributeChangedCallback(t,e,i){"value"!==t&&"highlight"!==t||this._updateMonth(),"highlight-days"===t&&this._updateGrid(),"culture"!==t&&"first-day"!==t||(this._updateGrid(),this._updateMonth())}static get observedAttributes(){return["value","culture","first-day","highlight-days","highlight"]}_updateGrid(){let t=null;if(!0===this.hasAttribute("culture"))try{t=zbCulture.find(this.getAttribute("culture")),null===t&&console.error("Culture not found")}catch(t){console.error("Culture not found")}null===t&&(t=zbCulture.default);let e=zbDayOfWeek.MONDAY;if(!0===this.hasAttribute("first-day")){const t=this.getAttribute("first-day").toLowerCase();"monday"===t&&(e=zbDayOfWeek.MONDAY),"tuesday"===t&&(e=zbDayOfWeek.TUESDAY),"wednesday"===t&&(e=zbDayOfWeek.WEDNESDAY),"thursday"===t&&(e=zbDayOfWeek.THURSDAY),"friday"===t&&(e=zbDayOfWeek.FRIDAY),"saturday"===t&&(e=zbDayOfWeek.SATURDAY),"sunday"===t&&(e=zbDayOfWeek.SUNDAY)}let i=[zbDayOfWeek.SATURDAY,zbDayOfWeek.SUNDAY];if(!0===this.hasAttribute("highlight-days")){const t=this.getAttribute("highlight-days").toLowerCase();i=[],t.split(",").forEach((function(t){"sunday"===t&&i.push(zbDayOfWeek.SUNDAY),"monday"===t&&i.push(zbDayOfWeek.MONDAY),"tuesday"===t&&i.push(zbDayOfWeek.TUESDAY),"wednesday"===t&&i.push(zbDayOfWeek.WEDNESDAY),"thursday"===t&&i.push(zbDayOfWeek.THURSDAY),"friday"===t&&i.push(zbDayOfWeek.FRIDAY),"saturday"===t&&i.push(zbDayOfWeek.SATURDAY)}))}for(let i=0;i<7;i++){const n=this._getColumnDayOfWeek(i,e),r=t.shortDayOfWeekList[n].toUpperCase();this._dayOfWeekList[i].childCell.innerText=r}for(let t=0;t<7;t++){const n=this._getColumnDayOfWeek(t,e);let r=!1;for(let t=0;t<i.length;t++){if(i[t]===n){r=!0;break}}for(let e=0;e<6;e++){const i=this._dayOfMonthList[e].dayList[t];i.defaultClass="parent-cell",i.defaultClass+=!0===r?(e+1)%2?" parent-highlightColumn-even":" parent-highlightColumn-odd":(e+1)%2?" parent-normal-even":" parent-normal-odd",i.parentCell.className=i.defaultClass}}}_updateMonth(){let t=zbDate.getToday();if(!0===this.hasAttribute("value"))try{t=zbDate.fromString(this.getAttribute("value"))}catch(t){return void console.error("Invalid date value. Format must be in YYYY-MM-DD.")}let e=!1;!0===this.hasAttribute("highlight")&&(e=!0);let i=zbDayOfWeek.MONDAY;if(!0===this.hasAttribute("first-day")){const t=this.getAttribute("first-day").toLowerCase();"monday"===t&&(i=zbDayOfWeek.MONDAY),"tuesday"===t&&(i=zbDayOfWeek.TUESDAY),"wednesday"===t&&(i=zbDayOfWeek.WEDNESDAY),"thursday"===t&&(i=zbDayOfWeek.THURSDAY),"friday"===t&&(i=zbDayOfWeek.FRIDAY),"saturday"===t&&(i=zbDayOfWeek.SATURDAY),"sunday"===t&&(i=zbDayOfWeek.SUNDAY)}const n=zbDate.getDaysInMonth(t.year,t.month),r=new zbDate(t.year,t.month,1),s=r.getDayOfWeek(),a=r.addMonths(-1),l=zbDate.getDaysInMonth(a.year,a.month);let o=-1,h=-1;for(let e=0;e<7;e++){if(this._getColumnDayOfWeek(e,i)===s){if(0===e){o=1,h=t.month;break}o=l-e+1,h=a.month;break}}for(let i=0;i<6;i++){const r=this._dayOfMonthList[i];for(let i=0;i<7;i++){const s=r.dayList[i];let a=!1;h!==t.month?o>l?(o=1,h++,h>12&&(h=1)):a=!0:o>n&&(a=!0,o=1,h++,h>12&&(h=1)),!0!==s.highlighted||o===t.day&&h===t.month||(s.parentCell.className=s.defaultClass,s.highlighted=!1),o===t.day&&h===t.month&&(!0===e?(s.parentCell.className="parent-cell parent-selected",s.highlighted=!0):(s.parentCell.className=s.defaultClass,s.highlighted=!1)),s.childCell.className=!1===a?"child-cell child-normal":"child-cell child-nonMonth",s.childCell.innerText=o.toString(),s.parentCell.nonMonth=a,s.parentCell.year=t.year,s.parentCell.day=o,s.parentCell.month=h,s.childCell.nonMonth=a,s.childCell.year=t.year,s.childCell.day=o,s.childCell.month=h,o++}}}_addClickEventListener(){for(let t=0;t<6;t++){const e=this._dayOfMonthList[t];for(let t=0;t<7;t++){e.dayList[t].parentCell.addEventListener("click",this._clickEvent)}}}_removeClickEventListener(){for(let t=0;t<6;t++){const e=this._dayOfMonthList[t];for(let t=0;t<7;t++){e.dayList[t].parentCell.removeEventListener("click",this._clickEvent)}}}_clickEvent(t){if(!0===t.target.nonMonth)return;const e=t.target.year,i=t.target.month,n=t.target.day,r=new zbDate(e,i,n);this.setAttribute("value",r.toString()),this.dispatchEvent(this.selectedEvent)}_getColumnDayOfWeek(t,e){let i=e+t;return i>=7&&(i-=7),0===i?zbDayOfWeek.SUNDAY:1===i?zbDayOfWeek.MONDAY:2===i?zbDayOfWeek.TUESDAY:3===i?zbDayOfWeek.WEDNESDAY:4===i?zbDayOfWeek.THURSDAY:5===i?zbDayOfWeek.FRIDAY:6===i?zbDayOfWeek.SATURDAY:zbDayOfWeek.MONDAY}}customElements.define("zb-calendar",zbCalendar);class zbDayCalendar extends HTMLElement{constructor(){super();const t=document.createElement("style");t.textContent="\n            :host {\n                display: inline-block;\n            }\n            .root {\n                min-width: 200px;\n                min-height: 200px;\n                user-select: none;\n            }\n            .header {\n                background-image: linear-gradient(rgb(248, 0, 0), rgb(200, 0, 0));\n                color: rgb(248, 248, 248);\n                border-top-left-radius: 10px;\n                border-top-right-radius: 10px;\n                border-top: 3px solid rgb(48, 48, 48);\n                border-left: 3px solid rgb(48, 48, 48);\n                border-right: 3px solid rgb(48, 48, 48);\n                font-size: 2em;\n                text-align: center;\n                padding: 0.5em;\n            }\n            .body {\n                background-color: white;\n                font-size: 6em;\n                color: rgb(48, 48, 48);\n                border-left: 3px solid rgb(48, 48, 48);\n                border-right: 3px solid rgb(48, 48, 48);\n                text-align: center;\n                padding: 0.1em;\n            }\n            .footer {\n                background-color: white;\n                color: rgb(48, 48, 48);\n                border-bottom-left-radius: 10px;\n                border-bottom-right-radius: 10px;\n                border-left: 3px solid rgb(48, 48, 48);\n                border-right: 3px solid rgb(48, 48, 48);\n                border-bottom: 3px solid rgb(48, 48, 48);\n                font-size: 1.5em;\n                text-align: center;\n                padding-left: 0.2em;\n                padding-right: 0.2em;\n                padding-bottom: 0.4em;\n            }";const e=document.createElement("div");e.setAttribute("class","root"),this._headerDiv=document.createElement("div"),this._headerDiv.setAttribute("class","header"),this._bodyDiv=document.createElement("div"),this._bodyDiv.setAttribute("class","body"),this._footerDiv=document.createElement("div"),this._footerDiv.setAttribute("class","footer"),e.appendChild(this._headerDiv),e.appendChild(this._bodyDiv),e.appendChild(this._footerDiv);const i=this.attachShadow({mode:"open"});i.appendChild(t),i.appendChild(e)}get culture(){return this.getAttribute("culture")}set culture(t){zbValidate.isString(t),this.setAttribute("culture",t)}get value(){return this.getAttribute("value")}set value(t){zbValidate.isString(t),this.setAttribute("value",t)}connectedCallback(){this._update()}attributeChangedCallback(t,e,i){"value"!==t&&"culture"!==t||this._update()}static get observedAttributes(){return["value","culture"]}_update(){let t=zbDate.getToday();if(!0===this.hasAttribute("value"))try{t=zbDate.fromString(this.getAttribute("value"))}catch(t){return void console.error("Invalid date value. Format must be in YYYY-MM-DD.")}let e=null;if(!0===this.hasAttribute("culture"))try{e=zbCulture.find(this.getAttribute("culture")),null===e&&console.error("Culture not found")}catch(t){console.error("Culture not found")}null===e&&(e=zbCulture.default);const i=e.monthList[t.month-1].toUpperCase(),n=t.getDayOfWeek(),r=e.dayOfWeekList[n].toUpperCase();this._headerDiv.innerText=i,this._bodyDiv.innerText=t.day.toString(),this._footerDiv.innerText=r}}customElements.define("zb-day-calendar",zbDayCalendar);class zbDigitalClock extends HTMLElement{constructor(){super();const t=document.createElement("style");t.textContent='\n            :host {\n                display: inline-block;\n            }\n            .root12 {\n                min-width: 280px;\n                min-height: 100px;\n                height: 100%;\n                width: 100%;\n                background-color: rgb(48, 48, 48);\n                display: grid;\n                grid-template-columns: 4fr 4fr 1fr 4fr 4fr 2fr;\n                grid-template-rows: 1fr;\n                grid-column-gap: 0.5em;\n                padding: 0.4em;\n            }\n            .root24 {\n                min-width: 280px;\n                min-height: 100px;\n                height: 100%;\n                width: 100%;\n                background-color: rgb(48, 48, 48);\n                display: grid;\n                grid-template-columns: 4fr 4fr 1fr 4fr 4fr;\n                grid-template-rows: 1fr;\n                grid-column-gap: 0.5em;\n                padding: 0.4em;\n            }\n            .digit {\n                height: 100%;\n                display: grid;\n                grid-template-columns: 1fr 2fr 1fr;\n                grid-template-rows: 1fr 2fr 1fr 2fr 1fr;\n                grid-column-gap: 1px;\n                grid-row-gap: 1px;\n            }\n            .digit-line-on {\n                background-color: rgb(248, 248, 248);\n            }\n            .digit-line-off {\n                background-color: rgb(55, 55, 55);\n            }\n            .digit-gap {\n                background-color: rgb(48, 48, 48);\n            }\n            .dots {      \n                height: 100%;\n                display: grid;\n                grid-template-columns: 1fr;\n                grid-template-rows: 2fr 1fr 3fr 1fr 2fr;\n                grid-column-gap: 1px;\n                grid-row-gap: 1px;\n            }\n            .dot {\n                background-color: rgb(248, 248, 248);\n                border-radius: 50%;\n            }\n            .ampm {\n                height: 100%;\n                display: grid;\n                grid-template-columns: 1fr;\n                grid-template-rows: 1fr 1fr;\n                grid-column-gap: 1px;\n                grid-row-gap: 1px;\n                font-family: "Lucida Console", Courier, monospace;\n                font-size: 1em;\n            }\n            .ampm-parent {\n                position: relative;\n                width: 100%;\n                height: 100%;\n            }\n            .ampm-child {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n            .ampm-on {\n                color: rgb(248, 248, 248);\n            }\n            .ampm-off {\n                color: rgb(55, 55, 55);\n            }\n            @keyframes blink {\n                50% {\n                    opacity: 0.0;\n                }\n            }\n            .blink {\n                animation: blink 1s step-start 0s infinite;\n            }',this._shadowRoot=this.attachShadow({mode:"open"}),this._shadowRoot.appendChild(t),this._update=this._update.bind(this)}get show24HourClock(){return!0===this.hasAttribute("show24HourClock")}set show24HourClock(t){zbValidate.isBoolean(t),!0===t?this.setAttribute("show24hour",t):this.removeAttribute("show24hour")}connectedCallback(){this._create(),this._update(),this._timerId=setInterval(this._update,1e3)}disconnectedCallback(){this.timerId&&(clearInterval(this._timerId),delete this._timerId)}attributeChangedCallback(t,e,i){"show24hour"===t&&(this._create(),this._update())}static get observedAttributes(){return["show24hour"]}_create(){let t=!1;!0===this.hasAttribute("show24hour")&&(t=!0);const e=document.createElement("div");!0===t?e.setAttribute("class","root24"):e.setAttribute("class","root12"),this._digit=[4],this._digit[0]={},this._digit[1]={},this._digit[2]={},this._digit[3]={};const i=this._createDigit(0),n=this._createDigit(1),r=this._createDots(),s=this._createDigit(2),a=this._createDigit(3);if(e.appendChild(i),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(a),!1===t){const t=this._createAmpm();e.appendChild(t)}this._rootDiv&&this._shadowRoot.removeChild(this._rootDiv),this._rootDiv=e,this._shadowRoot.appendChild(this._rootDiv),this._currentTime&&delete this._currentTime}_createDigit(t){const e=this._digit[t];e.lineList=[];const i=document.createElement("div");i.style.gridRow=1,i.style.gridColumn=e,i.className="digit";for(let t=1;t<=5;t++)for(let n=1;n<=3;n++){const r=document.createElement("div");r.style.gridRow=t,r.style.gridColumn=n,1===n&&1===t&&(r.style.borderTopLeftRadius="50%"),3===n&&1===t&&(r.style.borderTopRightRadius="50%"),1===n&&5===t&&(r.style.borderBottomLeftRadius="50%"),3===n&&5===t&&(r.style.borderBottomRightRadius="50%"),r.className="digit-line-off",2!==n||2!==t&&4!==t||(r.className="digit-gap"),i.appendChild(r),e.lineList.push(r)}return i}_createDots(){const t=document.createElement("div");t.style.gridRow=1,t.style.gridColumn=3,t.className="dots";const e=document.createElement("div");e.style.gridRow=2,e.style.gridColumn=1,e.className="dot blink";const i=document.createElement("div");return i.style.gridRow=4,i.style.gridColumn=1,i.className="dot blink",t.appendChild(e),t.appendChild(i),t}_createAmpm(){const t=document.createElement("div");t.style.gridRow=1,t.style.gridColumn=6,t.className="ampm";const e=document.createElement("div");e.style.gridRow=1,e.style.gridColumn=1;const i=document.createElement("div");i.className="ampm-parent",this._amChildDomElement=document.createElement("div"),this._amChildDomElement.className="ampm-child ampm-off",this._amChildDomElement.innerText="AM",i.appendChild(this._amChildDomElement),e.appendChild(i);const n=document.createElement("div");n.style.gridRow=2,n.style.gridColumn=1;const r=document.createElement("div");return r.className="ampm-parent",this._pmChildDomElement=document.createElement("div"),this._pmChildDomElement.className="ampm-child ampm-off",this._pmChildDomElement.innerText="PM",r.appendChild(this._pmChildDomElement),n.appendChild(r),t.appendChild(e),t.appendChild(n),t}_update(){const t=zbTime.getNow();if(this._currentTime&&this._currentTime.hour===t.hour&&this._currentTime.minute===t.minute)return;this._currentTime=t;let e=!1;!0===this.hasAttribute("show24hour")&&(e=!0);let i=t.hour;!1===e&&i>12&&(i-=12);let n=Math.floor(i/10);const r=i%10,s=Math.floor(t.minute/10),a=t.minute%10;!1===e&&0===n&&(n=-1),this._setDigitLines(this._digit[0],n),this._setDigitLines(this._digit[1],r),this._setDigitLines(this._digit[2],s),this._setDigitLines(this._digit[3],a),!1===e&&(this._currentTime.hour<12?(this._amChildDomElement.className="ampm-child ampm-on",this._pmChildDomElement.className="ampm-child ampm-off"):(this._amChildDomElement.className="ampm-child ampm-off",this._pmChildDomElement.className="ampm-child ampm-on"))}_setDigitLines(t,e){const i=zbDigitalClock._getNumberSwitchList(e);for(let e=0;e<15;e++){const n=t.lineList[e];!0===i[e]?n.className="digit-line-on":n.className="digit-line-off"}}static _getNumberSwitchList(t){return-1===t?[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]:0===t?[!0,!0,!0,!0,!1,!0,!0,!1,!0,!0,!1,!0,!0,!0,!0]:1===t?[!1,!1,!0,!1,!1,!0,!1,!1,!0,!1,!1,!0,!1,!1,!0]:2===t?[!0,!0,!0,!1,!1,!0,!0,!0,!0,!0,!1,!1,!0,!0,!0]:3===t?[!0,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!0,!0]:4===t?[!0,!1,!0,!0,!1,!0,!0,!0,!0,!1,!1,!0,!1,!1,!0]:5===t?[!0,!0,!0,!0,!1,!1,!0,!0,!0,!1,!1,!0,!0,!0,!0]:6===t?[!0,!0,!0,!0,!1,!1,!0,!0,!0,!0,!1,!0,!0,!0,!0]:7===t?[!0,!0,!0,!1,!1,!0,!1,!1,!0,!1,!1,!0,!1,!1,!0]:8===t?[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!1,!0,!0,!0,!0]:9===t?[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!0,!0,!0,!0]:void 0}}customElements.define("zb-digital-clock",zbDigitalClock);class zbFractal extends HTMLElement{constructor(){super();const t=document.createElement("style");t.textContent="\n            :host {\n                display: inline-block;\n            }\n            .root {\n                min-width: 200px;\n                min-height: 200px;\n                width: 100%;\n                height: 100%;\n                background-color: darkgray;\n                margin: 0px;\n                padding: 0px;\n            }";const e=document.createElement("div");e.setAttribute("class","root"),this._canvas=document.createElement("canvas"),this._canvas.style.padding="0px",this._canvas.style.margin="0px",this._canvas.style.display="block",e.appendChild(this._canvas);const i=this.attachShadow({mode:"open"});i.appendChild(t),i.appendChild(e),this._fractalWorkerMessage=this._fractalWorkerMessage.bind(this),this._render={},this._render.scaleX=0,this._render.scaleY=0,this._render.scaleWidth=0,this._render.pixelWidth=0,this._render.pixelHeight=0,this._render.lineFrom=0,this._render.lineTo=0,this._render.colorRange=32,this._render.colorMap="0,0,0,255,0,0",this._render.antiAliasing=1,this._render.interval=1e3,this._controlPressed=!1,this._clickEvent=this._clickEvent.bind(this),this._keydownEvent=this._keydownEvent.bind(this),this._keyupEvent=this._keyupEvent.bind(this)}connectedCallback(){this._canvas.style.width=this.getAttribute("pixel-width")+"px",this._canvas.style.height=this.getAttribute("pixel-height")+"px",this._canvas.width=this.getAttribute("pixel-width"),this._canvas.height=this.getAttribute("pixel-height"),this._canvasContext=this._canvas.getContext("2d"),this._canvas.addEventListener("click",this._clickEvent),window.addEventListener("keydown",this._keydownEvent),window.addEventListener("keyup",this._keyupEvent)}disconnectedCallback(){this.renderStop(),this._canvas.removeEventListener("click",this._clickEvent),window.removeEventListener("keydown",this._keydownEvent,!0),window.removeEventListener("keyup",this._keyupEvent,!0)}attributeChangedCallback(t,e,i){"pixel-width"!==t&&"pixel-height"!==t||(this._canvas.style.width=this.getAttribute("pixel-width")+"px",this._canvas.style.height=this.getAttribute("pixel-height")+"px",this._canvas.width=this.getAttribute("pixel-width"),this._canvas.height=this.getAttribute("pixel-height"))}static get observedAttributes(){return["pixel-width","pixel-height"]}_clickEvent(t){if(this._threadItemList&&0!==this._threadItemList.length)return;const e=this._render.pixelHeight/this._render.pixelWidth*this._render.scaleWidth,i=this._render.scaleX+t.clientX/this._render.pixelWidth*this._render.scaleWidth,n=this._render.scaleY+t.clientY/this._render.pixelHeight*e;let r=this._render.scaleWidth/2,s=e/2,a=i-r/2,l=n-s/2;!0===this._controlPressed&&(r=this._render.scaleWidth/.5,s=e/.5,a=i-r/2,l=n-s/2);const o={};o.pixelX=t.clientX,o.pixelY=t.clientY,o.scaleX=a,o.scaleY=l,o.scaleWidth=r,o.scaleHeight=s;const h=new CustomEvent("zoom",{detail:o});this.dispatchEvent(h)}_keydownEvent(t){"17"==t.which&&(this._controlPressed=!0)}_keyupEvent(t){"17"==t.which&&(this._controlPressed=!1)}renderStart(){this.renderStop();let t=1;!0===this.hasAttribute("threads")&&(t=parseInt(this.getAttribute("threads")),(t<1||t>12)&&(t=1));const e=this.getAttribute("fractal-worker-url");this._threadItemList=[];for(let i=0;i<t;i++){const t={};t.number=i,t.working=!1,t.fractalWorker=new Worker(e),t.fractalWorker.addEventListener("message",this._fractalWorkerMessage),this._threadItemList.push(t)}this._renderJobList=[];let i=1;for(let t=1;t<=this._canvas.height;t+=10){const e={};e.number=i,e.lineFrom=t,e.lineTo=t+10,e.lineTo>this._canvas.height&&(e.lineTo=this._canvas.height),e.working=!1,e.done=!1,this._renderJobList.push(e),i++}this._render.scaleX=parseFloat(this.getAttribute("scale-x")),this._render.scaleY=parseFloat(this.getAttribute("scale-y")),this._render.scaleWidth=parseFloat(this.getAttribute("scale-width")),this._render.pixelWidth=this._canvas.width,this._render.pixelHeight=this._canvas.height,this._render.colorRange=parseInt(this.getAttribute("color-range")),this._render.colorRange<8&&(this._render.colorRange=8),this._render.colorRange>128&&(this._render.colorRange=128),this._render.colorMap=this.getAttribute("color-map"),0===this._render.colorMap.length&&(this._render.colorMap="0,0,0,255,0,0"),this._render.antiAliasing=1,"1x1"===this.getAttribute("anti-aliasing")&&(this._render.antiAliasing=1),"2x2"===this.getAttribute("anti-aliasing")&&(this._render.antiAliasing=2),"4x4"===this.getAttribute("anti-aliasing")&&(this._render.antiAliasing=4),"8x8"===this.getAttribute("anti-aliasing")&&(this._render.antiAliasing=8),"16x16"===this.getAttribute("anti-aliasing")&&(this._render.antiAliasing=16),this._render.interval=parseInt(this.getAttribute("interval")),this._render.interval<250&&(this._render.interval=250),this._render.interval>1e6&&(this._render.interval=1e6),this._renderEngine()}renderStop(){if(this._threadItemList){for(let t=0;t<this._threadItemList.length;t++){this._threadItemList[t].fractalWorker.terminate()}this._threadItemList=[]}}_renderEngine(){const t=this._renderJobList.length;let e=0;for(let t=0;t<this._renderJobList.length;t++){!1!==this._renderJobList[t].done&&e++}const i={};i.toDo=t,i.done=e;const n=new CustomEvent("progress",{detail:i});this.dispatchEvent(n);for(let t=0;t<this._threadItemList.length;t++){const e=this._threadItemList[t];if(!0===e.working)continue;let i=null;for(let t=0;t<this._renderJobList.length;t++){const e=this._renderJobList[t];if(!0!==e.working&&!0!==e.done){i=e;break}}if(null===i)return void this._threadItemList.splice(t,1);this._render.threadNumber=e.number,this._render.jobNumber=i.number,this._render.lineFrom=i.lineFrom,this._render.lineTo=i.lineTo,i.working=!0,e.fractalWorker.postMessage(this._render),e.working=!0}}_fractalWorkerMessage(t){if(!1!==t.data.done){for(let e=0;e<this._threadItemList.length;e++){const i=this._threadItemList[e];if(i.number===t.data.threadNumber){i.working=!1;break}}for(let e=0;e<this._renderJobList.length;e++){const i=this._renderJobList[e];if(i.number===t.data.jobNumber){i.working=!1,i.done=!0;break}}this._renderEngine()}else{const e=t.data.linePixelData;this._canvasContext.putImageData(e,0,t.data.lineNumber-1)}}}window.customElements.define("zb-fractal",zbFractal);